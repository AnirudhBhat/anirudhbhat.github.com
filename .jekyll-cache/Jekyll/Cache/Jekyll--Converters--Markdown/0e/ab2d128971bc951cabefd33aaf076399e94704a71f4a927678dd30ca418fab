I"`<p>Most of us might have faced the problem of losing the scroll position of the <code class="highlighter-rouge">RecyclerView</code> when your <code class="highlighter-rouge">Activity/Fragment</code> is recreated. This usually happens because the <code class="highlighter-rouge">Adapter</code> data is loaded asynchronously and data hasn’t loaded by the time <code class="highlighter-rouge">RecyclerView</code> needs to layout so it fails to restore the scroll position.</p>

<p><code class="highlighter-rouge">RecyclerView</code> already has a solution to this problem. The <code class="highlighter-rouge">LayoutManager</code> supports <code class="highlighter-rouge">onRestoreInstanceState</code> method which will help us save scroll positions.</p>

<p>Let’s see small code snippet on how to use this</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>private var recyclerScrollPosition: Int? = null
private var recyclerView: RecyclerView? = null

override public fun onCreate(savedInstanceState: Bundle?) {
	super.onCreate(savedInstanceState)
	recyclerScrollPosition=savedInstanceState.getParcelable("scrollPosition")
}

override fun onSaveInstanceState(outState: Bundle) {
	super.onSaveInstanceState(outState)
	outState.putParcelable("scrollPosition",recyclerView.layoutManager.onSaveInstanceState())
}
</code></pre></div></div>

<p>Once your async operation is done and reattached to <code class="highlighter-rouge">RecyclerView</code> then call this method</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>recyclerView.layoutManager.onRestoreInstanceState(recyclerScrollPosition)
</code></pre></div></div>

<p>Even the above solution restores the scroll position of <code class="highlighter-rouge">RecyclerView</code> whenever <code class="highlighter-rouge">Activity/Fragment</code> gets recreated but it requires a bit of code and also we must make sure to call <code class="highlighter-rouge">onRestoreInstanceState</code> at the appropriate position and also should make sure that parcelable state that we pass to the <code class="highlighter-rouge">onRestoreInstanceState</code>method is not null.</p>

<p>Starting from <code class="highlighter-rouge">1.2.0-alpha02</code>, We don’t have to write all these codes just to restore the scroll position. <code class="highlighter-rouge">RecyclerView</code> offers a new API to let the Adapter block layout restoration until it is ready.</p>

<p>The <code class="highlighter-rouge">recyclerview:1.2.0-alpha02</code> solution allows you to set a state restoration policy via the StateRestorationPolicy enum. This has 3 options.</p>

<ol>
  <li><strong>ALLOW</strong></li>
  <li><strong>PREVENT_WHEN_EMPTY</strong></li>
  <li><strong>PREVENT</strong></li>
</ol>

<p>All we have to do is set the restoration policy on the adapter like this</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> adapter.stateRestorationPolicy = PREVENT_WHEN_EMPTY
</code></pre></div></div>

<p>Let’s see what those options mean and how to use them.</p>

<p><strong>ALLOW</strong>: This is the default state. It restores the <code class="highlighter-rouge">RecyclerView</code> state immediately, in the next layout pass.</p>

<p>Since this restores the state immediately this will not be useful if you have an async operation and you are setting the adapter with the result after you get the response. This will be useful if you don’t have an async operation and are setting the <code class="highlighter-rouge">RecyclerView</code> adapter with the result list as soon as you initialize. Below you can see the gif of how it looks when applied to asynchronous vs synchronous operation</p>

<p><strong>PREVENT_WHEN_EMPTY</strong>: This one restores the <code class="highlighter-rouge">RecyclerView</code> state only when the adapter is not empty (adapter.itemCount &gt; 0)</p>

<p>This one is suitable when you have async operation going on because <code class="highlighter-rouge">RecyclerView</code> state will be restored only after you update your adapter with the data. This can also be used when you already have the list and are populating the adapter with the list when you initialize and provides the same result.</p>

<p>In the below gif you can see that I have added a delay to fake the async operation, Once the delay is over I am populating the adapter with the list.</p>

<p>PREVENT:  All state restoration is deferred until you set <code class="highlighter-rouge">ALLOW</code> or <code class="highlighter-rouge">PREVENT_WHEN_EMPTY</code>.</p>

<p>When you set this restoration policy while you initialize your adapter then after you get the results and update the adapter, the scroll position will not be restored unless you set either <code class="highlighter-rouge">ALLOW</code> or <code class="highlighter-rouge">PREVENT_WHEN_EMPTY</code> while updating your adapter with the result list.</p>
:ET